# Система оценки задач

## Роль системы

Agent Fleet выступает как **исполнитель** в проекте — полноценный участник команды, который оценивает, берёт и выполняет задачи.

В отличие от обычного инструмента, Agent Fleet:
- Получает задачи из системы управления проектами
- Самостоятельно оценивает трудозатраты
- Отчитывается о прогрессе
- Соблюдает временные ограничения

## Жизненный цикл таски

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  Новая   │───▶│  Оценка  │───▶│  Ready   │───▶│  В работе│
│  таска   │    │          │    │          │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                     │                               │
                     ▼                               ▼
              ┌──────────┐                    ┌──────────┐
              │  Апрув   │                    │  Done /  │
              │  оценки  │                    │  Review  │
              └──────────┘                    └──────────┘
                                                   │
                                                   ▼
                                            ┌──────────────┐
                                            │  Превышение  │
                                            │  лимита      │
                                            └──────────────┘
                                                   │
                                                   ▼
                                            ┌──────────────┐
                                            │  Переоценка  │
                                            └──────────────┘
```

### 1. Оценка (автоматическая)

При появлении новой таски в юзер-стори запускается автоматическая оценка:

**Входные данные для анализа:**
- Описание таски
- Acceptance criteria
- Связанный код в репозитории (файлы, затрагиваемые таской)
- История похожих задач (если есть)
- Контекст юзер-стори и эпика

**Процесс оценки:**
1. Claude анализирует таску и код
2. Определяет объём изменений
3. Учитывает потенциальные риски
4. Выдаёт оценку в часах

**Результат:**
- Оценка добавляется в таску
- Комментарий с обоснованием оценки
- Статус таски меняется на "Требует апрува оценки"
- Уведомление ответственному в Telegram

### 2. Апрув оценки

Ответственный (assignee из системы задач) подтверждает оценку:
- **Принять** — оценка утверждается, таска переходит в Ready
- **Скорректировать** — указывается новая оценка с комментарием
- **Отклонить** — таска возвращается на переформулировку

### 3. Взятие в работу

После апрува оценки:
- Таска автоматически берётся в работу
- Стартует таймер затраченного времени
- Статус меняется на "In Progress"
- Уведомление ответственному в Telegram

### 4. Выполнение

Во время выполнения:
- Прогресс логируется в комментариях к таске
- Затраченное время отслеживается
- При возникновении вопросов — запрос к ответственному через Telegram

**Логирование прогресса:**
```
[12:30] Начата работа над таской
[12:45] Проанализирован код модуля auth
[13:00] Внесены изменения в 3 файла
[13:15] Запущены тесты
```

### 5. Контроль превышения

**Правило 20%:** фактическое время не должно превышать оценку более чем на 20%.

```
Лимит = Оценка × 1.2
```

**Предупреждение (80% лимита):**
- Уведомление в Telegram: "Достигнуто 80% лимита времени"
- Комментарий в таске с текущим статусом

**Превышение лимита (100%):**
- Работа автоматически останавливается
- Таска переходит в режим переоценки

### 6. Переоценка

При превышении лимита:

1. **Фиксация прогресса:**
   - Текущее состояние коммитится в ветку
   - Комментарий с описанием выполненного
   - Комментарий с описанием оставшейся работы

2. **Анализ причин:**
   - Неточная оценка
   - Обнаружены дополнительные требования
   - Технические сложности
   - Блокирующие зависимости

3. **Запрос переоценки:**
   - Статус меняется на "Требует переоценки"
   - Уведомление ответственному с объяснением причин
   - Предложение новой оценки на оставшуюся работу

4. **Решение ответственного:**
   - Утвердить новую оценку и продолжить
   - Разбить таску на подзадачи
   - Отменить таску

## Метрики

Agent Fleet собирает метрики для улучшения оценок:

| Метрика | Описание |
|---------|----------|
| Точность оценки | Отношение факта к оценке |
| Процент переоценок | Доля задач с превышением лимита |
| Среднее отклонение | Среднее отклонение факта от оценки |

Эти данные используются для калибровки будущих оценок.

## Связанные документы

- [CONCEPT.md](./CONCEPT.md) — основная концепция Agent Fleet
